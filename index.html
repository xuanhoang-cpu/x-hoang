<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Cổng TTĐT UBND xã</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{margin:0;background:#f4f6f8}

/* ===== HEADER TTĐT ===== */
.site-header{
  background:#0d47a1;color:#fff
}
.header-inner{
  max-width:1100px;margin:auto;
  display:flex;align-items:center;
  gap:18px;padding:14px
}
.logo{width:70px}
.title .l1{font-size:14px}
.title .l2{font-size:22px;font-weight:700}
.title .l3{font-size:13px;opacity:.9}

/* ===== MAIN ===== */
.container{max-width:1100px;margin:30px auto;text-align:center}
h1{color:#0d47a1;margin-bottom:40px}

/* ===== PERSON ===== */
.person-img{
  width:160px;height:220px;object-fit:cover;
  border-radius:12px;border:4px solid #1565c0;
}
.role{color:#1565c0;font-weight:600;margin-top:8px}
h3{margin:6px 0 0}
.chairman{margin-bottom:60px}
.deputies{display:flex;justify-content:center;gap:50px;flex-wrap:wrap}

/* ===== ADMIN ===== */
.admin-bar{display:none;text-align:right;margin-bottom:10px}
.admin-bar button{
  padding:6px 12px;margin-left:5px;
  background:#1565c0;color:#fff;
  border:none;border-radius:4px;cursor:pointer
}
input[type=file]{display:none}

/* ===== MODAL ===== */
.modal{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  justify-content:center;align-items:center;z-index:999
}
.modal-content{
  background:#fff;width:700px;max-width:95%;
  padding:25px;border-radius:12px;position:relative
}
.close{position:absolute;top:10px;right:15px;font-size:26px;cursor:pointer}
.desc-box{max-height:350px;overflow:auto;text-align:left}
.desc-box li{margin-bottom:6px}
</style>
</head>

<body>

<header class="site-header">
  <div class="header-inner">
    <img class="logo"
     src="https://upload.wikimedia.org/wikipedia/commons/2/2f/Emblem_of_Vietnam.svg">
    <div class="title">
      <div class="l1">ỦY BAN NHÂN DÂN XÃ</div>
      <div class="l2">MỸ ĐỨC</div>
      <div class="l3">CỔNG THÔNG TIN ĐIỆN TỬ</div>
    </div>
  </div>
</header>

<div class="container">
<h1>LÃNH ĐẠO UBND XÃ</h1>

<div class="admin-bar">
<button onclick="adminLogin()">Quản trị</button>
<button onclick="changePassword()">Đổi mật khẩu</button>
<button onclick="viewLogs()">Nhật ký</button>
<input type="file" id="imgUpload" accept="image/*" onchange="uploadImg(event)">
</div>

<div class="chairman">
<img id="img1" class="person-img">
<p class="role">Chủ tịch UBND xã</p>
<h3>ĐẶNG ĐÌNH TRIỀU</h3>
</div>

<div class="deputies">
<div>
<img id="img2" class="person-img">
<p class="role">Phó Chủ tịch</p>
<h3>TRẦN PHÚC HUY</h3>
</div>
<div>
<img id="img3" class="person-img">
<p class="role">Phó Chủ tịch</p>
<h3>HUỲNH TẤN CƯỜNG</h3>
</div>
</div>
</div>

<div class="modal" id="modal">
<div class="modal-content">
<span class="close" onclick="modal.style.display='none'">×</span>
<div class="desc-box" id="modalDesc"></div>
</div>
</div>

<script>
/* ===== ADMIN / HASH ===== */
const DEFAULT_HASH="240be518fabd2724ddb6f04eeb1da596"; // đổi hash của bạn
let ADMIN_HASH=localStorage.getItem("adminHash")||DEFAULT_HASH;
let currentImgId="";
const isAdmin=location.search.includes("admin=1");

/* ===== HASH ===== */
async function hash(p){
  const b=new TextEncoder().encode(p);
  const h=await crypto.subtle.digest("SHA-256",b);
  return [...new Uint8Array(h)].map(x=>x.toString(16).padStart(2,"0")).join("");
}

/* ===== LOGIN ===== */
async function adminLogin(){
  const p=prompt("Nhập mật khẩu quản trị:");
  if(!p)return;
  if(await hash(p)===ADMIN_HASH){
    enableAdmin();
    alert("Đã vào chế độ quản trị");
  }else alert("Sai mật khẩu!");
}

function enableAdmin(){
  document.querySelectorAll(".person-img").forEach(img=>{
    img.onclick=()=>{
      currentImgId=img.id;
      imgUpload.click();
    }
  });
}

/* ===== CHANGE PASS ===== */
async function changePassword(){
  const oldP=prompt("Mật khẩu hiện tại:");
  if(await hash(oldP)!==ADMIN_HASH)return alert("Sai mật khẩu");
  const newP=prompt("Mật khẩu mới (≥6 ký tự):");
  if(!newP||newP.length<6)return;
  ADMIN_HASH=await hash(newP);
  localStorage.setItem("adminHash",ADMIN_HASH);
  writeLog("Đổi mật khẩu quản trị");
  alert("Đã đổi mật khẩu");
}

/* ===== LOG ===== */
function writeLog(action){
  const logs=JSON.parse(localStorage.getItem("logs")||"[]");
  logs.unshift({time:new Date().toLocaleString("vi-VN"),action});
  localStorage.setItem("logs",JSON.stringify(logs.slice(0,50)));
}
function viewLogs(){
  const logs=JSON.parse(localStorage.getItem("logs")||"[]");
  let html="<h3>Nhật ký chỉnh sửa</h3><ul>";
  logs.forEach(l=>html+=`<li>[${l.time}] ${l.action}</li>`);
  modalDesc.innerHTML=html+"</ul>";
  modal.style.display="flex";
}

/* ===== IMAGE ===== */
function uploadImg(e){
  const f=e.target.files[0];
  if(!f)return;
  const r=new FileReader();
  r.onload=()=>{
    localStorage.setItem(currentImgId,r.result);
    document.getElementById(currentImgId).src=r.result;
    writeLog("Cập nhật ảnh: "+currentImgId);
  };
  r.readAsDataURL(f);
}

["img1","img2","img3"].forEach(id=>{
  document.getElementById(id).src=
    localStorage.getItem(id)||
    "https://via.placeholder.com/160x220?text=Ảnh";
});

/* ===== INIT ===== */
if(isAdmin) document.querySelector(".admin-bar").style.display="block";
</script>
</body>
</html>
